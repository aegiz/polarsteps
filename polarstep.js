const fetch = require("node-fetch");

const TRIP_ID = 3703825; // Something you get in the URL once the trip has been created

const inputs = [
  { start: "2020-04-01", lon: "4.837067382196995", lat: "52.37243058415131" },
  { start: "2020-04-02", lon: "4.844464222883373", lat: "52.37303377805576" },
  { start: "2020-04-03", lon: "4.847040103359832", lat: "52.38347081647134" },
  { start: "2020-04-04", lon: "4.855058765650798", lat: "52.39115638268255" },
  { start: "2020-04-05", lon: "4.88639037370076", lat: "52.3722877838174" },
  { start: "2020-04-06", lon: "4.837049572760471", lat: "52.37248880503336" },
  { start: "2020-04-07", lon: "4.857495055194383", lat: "52.37405482499357" },
  { start: "2020-04-08", lon: "4.859056471821097", lat: "52.37906420341329" },
  { start: "2020-04-09", lon: "4.863826505701104", lat: "52.38369960770434" },
  { start: "2020-04-10", lon: "4.854962211671625", lat: "52.39114362957896" },
  { start: "2020-04-11", lon: "4.87079209281275", lat: "52.37789968504768" },
  { start: "2020-04-12", lon: "4.859053421568646", lat: "52.37904519076114" },
  { start: "2020-04-13", lon: "4.868544113056528", lat: "52.37528606190413" },
  { start: "2020-04-14", lon: "4.857504878251451", lat: "52.37407604316279" },
  { start: "2020-04-15", lon: "4.873903910226359", lat: "52.37576420581776" },
  { start: "2020-04-16", lon: "4.870795671210568", lat: "52.37782953481997" },
  { start: "2020-04-17", lon: "4.873898779088504", lat: "52.3757430927487" },
  { start: "2020-04-18", lon: "4.879657255871736", lat: "52.37623268622228" },
  { start: "2020-04-19", lon: "4.88609191799611", lat: "52.40394330998502" },
  { start: "2020-04-20", lon: "4.885029479909901", lat: "52.39940761529587" },
  { start: "2020-04-21", lon: "4.869681527505813", lat: "52.39766111260867" },
  { start: "2020-04-22", lon: "4.855014369359054", lat: "52.3910994602883" },
  { start: "2020-04-23", lon: "4.867161789489975", lat: "52.38561200085782" },
  { start: "2020-04-24", lon: "4.874618834392106", lat: "52.3893140356525" },
  { start: "2020-04-25", lon: "4.883002205681233", lat: "52.39056055481592" },
  { start: "2020-04-26", lon: "4.881241188171776", lat: "52.38289362429942" },
  { start: "2020-04-27", lon: "4.874591581521126", lat: "52.38935136032028" },
  { start: "2020-04-28", lon: "4.876457749918459", lat: "52.38185802848025" },
  { start: "2020-04-29", lon: "4.867378994002332", lat: "52.38567474017326" },
  { start: "2020-04-30", lon: "4.880635501215367", lat: "52.38009925585168" },
  { start: "2020-05-01", lon: "4.879686345069207", lat: "52.37629300096761" },
  { start: "2020-05-02", lon: "4.886389507651508", lat: "52.37225369191461" },
  { start: "2020-05-03", lon: "4.886143368719312", lat: "52.40390249115924" },
  { start: "2020-05-04", lon: "4.887422715235017", lat: "52.39967075857585" },
  { start: "2020-05-05", lon: "4.902993252355643", lat: "52.39739963135587" },
  { start: "2020-05-06", lon: "4.917930946329583", lat: "52.39132316756092" },
  { start: "2020-05-07", lon: "4.904901907583669", lat: "52.38641270899267" },
  { start: "2020-05-08", lon: "4.898315041132335", lat: "52.38906317741815" },
  { start: "2020-05-09", lon: "4.889699690007507", lat: "52.39039205222032" },
  { start: "2020-05-10", lon: "4.88744166916868", lat: "52.39967810055427" },
  { start: "2020-05-11", lon: "4.891461291962235", lat: "52.38331245364432" },
  { start: "2020-05-12", lon: "4.898334177600445", lat: "52.38902339368654" },
  { start: "2020-05-13", lon: "4.895976178481723", lat: "52.38207273541202" },
  { start: "2020-05-14", lon: "4.904911133042987", lat: "52.38635256619553" },
  { start: "2020-05-15", lon: "4.892317136837945", lat: "52.38025426560114" },
  { start: "2020-05-16", lon: "4.891426216894265", lat: "52.38331087195764" },
  { start: "2020-05-17", lon: "4.8933691555366", lat: "52.37647288290477" },
  { start: "2020-05-18", lon: "4.886281751839475", lat: "52.37218269645955" },
  { start: "2020-05-19", lon: "4.917967658294211", lat: "52.39131930480139" },
  { start: "2020-05-20", lon: "4.926813796339493", lat: "52.38105111779485" },
  { start: "2020-05-21", lon: "4.928530260594424", lat: "52.37282548970125" },
  { start: "2020-05-22", lon: "4.914925958758028", lat: "52.37427358352129" },
  { start: "2020-05-23", lon: "4.91322818132037", lat: "52.37930064602806" },
  { start: "2020-05-24", lon: "4.908607361713941", lat: "52.38374326847241" },
  { start: "2020-05-25", lon: "4.917913063620849", lat: "52.3913193421266" },
  { start: "2020-05-26", lon: "4.901543703635887", lat: "52.37795799115226" },
  { start: "2020-05-27", lon: "4.913232492122845", lat: "52.37929184340977" },
  { start: "2020-05-28", lon: "4.904047347540881", lat: "52.3753733525836" },
  { start: "2020-05-29", lon: "4.898603679368208", lat: "52.37593555519083" },
  { start: "2020-05-30", lon: "4.901503112172756", lat: "52.37793822233083" },
  { start: "2020-06-01", lon: "4.898603679368208", lat: "52.37593555519083" },
  { start: "2020-06-02", lon: "4.8933691555366", lat: "52.37647288290477" },
  { start: "2020-06-03", lon: "4.934461745542231", lat: "52.37220174325364" },
  { start: "2020-06-04", lon: "4.886441013936265", lat: "52.3722232087629" },
  { start: "2020-06-05", lon: "4.892239256072529", lat: "52.36813245149573" },
  { start: "2020-06-06", lon: "4.903272929378824", lat: "52.36920654246376" },
  { start: "2020-06-07", lon: "4.912568164882307", lat: "52.36539549330278" },
  { start: "2020-06-08", lon: "4.901973962551383", lat: "52.36626957096635" },
  { start: "2020-06-09", lon: "4.898813677110143", lat: "52.3687668969285" },
  { start: "2020-06-10", lon: "4.915216135716928", lat: "52.37033654862996" },
  { start: "2020-06-11", lon: "4.912511556209358", lat: "52.36539552706288" },
  { start: "2020-06-12", lon: "4.907756222309825", lat: "52.36076783718934" },
  { start: "2020-06-13", lon: "4.901971862954326", lat: "52.36623153080711" },
  { start: "2020-06-14", lon: "4.914467400588151", lat: "52.35443420061593" },
  { start: "2020-06-15", lon: "4.925463349252956", lat: "52.36345062684401" },
  { start: "2020-06-16", lon: "4.928356347716005", lat: "52.37159703555128" },
  { start: "2020-06-17", lon: "4.934439839189659", lat: "52.37219070829109" },
  { start: "2020-06-18", lon: "4.892244172905009", lat: "52.3681213085609" },
  { start: "2020-06-19", lon: "4.914447818140428", lat: "52.35443267219289" },
  { start: "2020-06-20", lon: "4.895745830431848", lat: "52.36280046246818" },
  { start: "2020-06-21", lon: "4.897126574358261", lat: "52.35643242320573" },
  { start: "2020-06-22", lon: "4.890538287844639", lat: "52.36152710142089" },
  { start: "2020-06-23", lon: "4.891345013207391", lat: "52.36469711547074" },
  { start: "2020-06-24", lon: "4.895747903983398", lat: "52.36279568208179" },
  { start: "2020-06-25", lon: "4.891345951020998", lat: "52.36468883325834" },
  { start: "2020-06-26", lon: "4.892241557753394", lat: "52.36811758072309" },
  { start: "2020-06-27", lon: "4.888850180787959", lat: "52.35509108864598" },
  { start: "2020-06-28", lon: "4.897114671810574", lat: "52.35641722599304" },
  { start: "2020-06-29", lon: "4.903936683714658", lat: "52.35913667986595" },
  { start: "2020-06-30", lon: "4.914454915175348", lat: "52.354427628207" },
  { start: "2020-07-01", lon: "4.900054904685744", lat: "52.34890052596825" },
  { start: "2020-07-02", lon: "4.886393344193911", lat: "52.34755522150425" },
  { start: "2020-07-03", lon: "4.885244650807721", lat: "52.34414160384801" },
  { start: "2020-07-04", lon: "4.8888023052808", lat: "52.35506535920161" },
  { start: "2020-07-05", lon: "4.885229945958603", lat: "52.34416288931518" },
  { start: "2020-07-06", lon: "4.886387856763941", lat: "52.37222243615133" },
  { start: "2020-07-07", lon: "4.8794822284761", lat: "52.36827160144531" },
  { start: "2020-07-08", lon: "4.88521753557702", lat: "52.34414122967333" },
  { start: "2020-07-09", lon: "4.884436306310143", lat: "52.3475869839979" },
  { start: "2020-07-10", lon: "4.871151806055143", lat: "52.34917210161801" },
  { start: "2020-07-11", lon: "4.856508441495883", lat: "52.35507888636729" },
  { start: "2020-07-12", lon: "4.847430553722473", lat: "52.3632340507119" },
  { start: "2020-07-13", lon: "4.844730095172698", lat: "52.37169299501863" },
  { start: "2020-07-14", lon: "4.857156915318543", lat: "52.37042663318973" },
  { start: "2020-07-15", lon: "4.859776113364433", lat: "52.36536702257802" },
  { start: "2020-07-16", lon: "4.864628904079364", lat: "52.36150853106763" },
  { start: "2020-07-17", lon: "4.856622677166927", lat: "52.35501848338704" },
  { start: "2020-07-18", lon: "4.868088178042784", lat: "52.35913098557735" },
  { start: "2020-07-19", lon: "4.874835852232085", lat: "52.35649504215656" },
  { start: "2020-07-20", lon: "4.882683299610941", lat: "52.35511949154608" },
  { start: "2020-07-21", lon: "4.881097903754766", lat: "52.36152627073002" },
  { start: "2020-07-22", lon: "4.874822111427031", lat: "52.35645135490095" },
  { start: "2020-07-23", lon: "4.876572903733603", lat: "52.36253192361153" },
  { start: "2020-07-24", lon: "4.868088178042784", lat: "52.35913098557735" },
  { start: "2020-07-25", lon: "4.880492951623776", lat: "52.36410517414141" },
  { start: "2020-07-26", lon: "4.879473069426421", lat: "52.3682694536697" },
  { start: "2020-07-27", lon: "4.856628837509742", lat: "52.35498816362681" },
  { start: "2020-07-28", lon: "4.870822837117292", lat: "52.36655399950982" },
  { start: "2020-07-29", lon: "4.859803777886686", lat: "52.36536745538933" },
  { start: "2020-07-30", lon: "4.868694396011288", lat: "52.36928818161539" },
  { start: "2020-08-01", lon: "4.873752878967899", lat: "52.36881053346636" },
  { start: "2020-08-02", lon: "4.870848478604366", lat: "52.36652942482695" },
  { start: "2020-08-03", lon: "4.873732508482281", lat: "52.36879598603955" },
  { start: "2020-08-04", lon: "4.879470396111232", lat: "52.36824156462706" },
  { start: "2020-08-05", lon: "4.837077726455846", lat: "52.3724180899146" },
];

const makeRequest = (nb) => {
  // Location request
  fetch("https://www.polarsteps.com/api/locations", {
    headers: {
      accept: "*/*",
      "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
      "cache-control": "no-cache",
      "content-type": "application/json",
      "polarsteps-api-version": "11",
      pragma: "no-cache",
      "sec-fetch-dest": "empty",
      "sec-fetch-mode": "cors",
      "sec-fetch-site": "same-origin",
      cookie:
        "_ga=GA1.2.1610489187.1597690375; _fbp=fb.1.1597690384000.2042532823; _gid=GA1.2.789637026.1597839855; remember_token=2907717|16ef56d93696cf6ea483f98d8b4e570d35fe3a32; mp_204e5b13fb0844e6f13e8f9b3543c2ab_mixpanel=%7B%22distinct_id%22%3A%20%22173fdc476b67de-0f97b72dfd7aaa-6837027e-1aeaa0-173fdc476b76e1%22%2C%22%24device_id%22%3A%20%22173fdc476b67de-0f97b72dfd7aaa-6837027e-1aeaa0-173fdc476b76e1%22%2C%22%24initial_referrer%22%3A%20%22%24direct%22%2C%22%24initial_referring_domain%22%3A%20%22%24direct%22%7D; _gat=1; session=eyJfZnJlc2giOmZhbHNlLCJfaWQiOnsiIGIiOiJZelpqWWpjNVltSTVPRFZpT0RrME1UbGpaalZsWlRBMU5qY3pNRGRpWmpFPSJ9LCJ1c2VyX2lkIjoiMjkwNzcxNyJ9.Eh_toQ.2o_OeIVsvJqfedRqMeeXfwIqZjU",
    },
    referrerPolicy: "no-referrer-when-downgrade",
    body:
      '{"name":"Amsterdam","lat":' +
      inputs[nb].lat +
      ',"lon":' +
      inputs[nb].lon +
      ',"detail":"Netherlands","full_detail":"Noord-Holland, Netherlands","country_code":"NL"}',
    method: "POST",
    mode: "cors",
  })
    .then((res) => {
      if (res.status >= 400) {
        throw new Error("Bad response from server");
      }
      return res.json();
    })
    .then((data) => {
      // Step request
      fetch("https://www.polarsteps.com/api/steps", {
        headers: {
          accept: "*/*",
          "accept-language": "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7",
          "cache-control": "no-cache",
          "content-type": "application/json",
          "polarsteps-api-version": "11",
          pragma: "no-cache",
          "sec-fetch-dest": "empty",
          "sec-fetch-mode": "cors",
          "sec-fetch-site": "same-origin",
          cookie:
            "_ga=GA1.2.1610489187.1597690375; _fbp=fb.1.1597690384000.2042532823; _gid=GA1.2.789637026.1597839855; remember_token=2907717|16ef56d93696cf6ea483f98d8b4e570d35fe3a32; mp_204e5b13fb0844e6f13e8f9b3543c2ab_mixpanel=%7B%22distinct_id%22%3A%20%22173fdc476b67de-0f97b72dfd7aaa-6837027e-1aeaa0-173fdc476b76e1%22%2C%22%24device_id%22%3A%20%22173fdc476b67de-0f97b72dfd7aaa-6837027e-1aeaa0-173fdc476b76e1%22%2C%22%24initial_referrer%22%3A%20%22%24direct%22%2C%22%24initial_referring_domain%22%3A%20%22%24direct%22%7D; _gat=1; session=eyJfZnJlc2giOmZhbHNlLCJfaWQiOnsiIGIiOiJZelpqWWpjNVltSTVPRFZpT0RrME1UbGpaalZsWlRBMU5qY3pNRGRpWmpFPSJ9LCJ1c2VyX2lkIjoiMjkwNzcxNyJ9.Eh_tpw.8tr7OAc59MfpxFCJE5Dejcw7oNA",
        },
        referrerPolicy: "no-referrer-when-downgrade",
        body:
          '{"trip_id":' +
          TRIP_ID +
          ',"location_id":' +
          data.id +
          ',"name":"' +
          (nb + 1) +
          '","description":"' +
          inputs[nb].lat +
          ", " +
          inputs[nb].lon +
          '","start_time":"' +
          inputs[nb].start +
          'T10:00:00+00:00","creation_time":"' +
          inputs[nb].start +
          'T14:09:01+00:00","timezone_id":"Europe/Amsterdam"}',
        method: "POST",
        mode: "cors",
      })
        .then((res) => {
          if (res.status >= 400) {
            throw new Error("Bad response from server");
          }
          return res.json();
        })
        .then((data) => {
          console.log("DONE ", nb + 1);
          if (nb + 1 === inputs.length) {
            console.log("Finish!");
          } else {
            makeRequest(nb + 1);
          }
        })
        .catch((err) => {
          console.error(err);
        });
    })
    .catch((err) => {
      console.error(err);
    });
};

makeRequest(0);
